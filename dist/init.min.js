const wi={css:{ELEMENT:'chrome-extension-wi-element',COLOR_SELECT_CLASS:'chrome-extension-wi-color_select',CLOSE_BUTTON_CLASS:'chrome-extension-wi-close_button',CONTENT_BOX_CLASS:'chrome-extension-wi-content_box',DATA_BOX_CLASS:'chrome-extension-wi-data_box',DATA_FIELD:'chrome-extension-wi-data_field',FILLER_BOX_CLASS:'chrome-extension-wi-filler_box'},current:{active:!1,contentBox:$(),element:$(),elements:$(),addElements(a){0<a.length&&(a.addClass(wi.css.ELEMENT).on('click',wi.events.elementClick),this.elements=this.elements.add(a))},resetElements(){this.elements.removeClass(wi.css.ELEMENT).off('click',wi.events.elementClick),this.elements=$()},toggleStatus(){const a=wi.elements;let b='';this.active=!this.active,this.active?(b='on',this.addElements($(a.selector).filter(a.filter))):(b='off',this.resetElements(),wi.box.remove()),$(document)[b]('click',wi.events.documentClicked)[b]('DOMNodeInserted',wi.events.elementCreated),$(window)[b]('keydown',wi.events.keyPress)[b]('resize scroll',wi.events.windowResizeOrScroll)}},elements:{selector:'',containers:'',filter:'',CONTENT:['ARTICLE','ASIDE','DIV','FIELDSET','FOOTER','FORM','HEADER','MAIN','NAV','OL','SECTION','TABLE','UL'],FORM:['BUTTON','INPUT','KEYGEN','OUTPUT','SELECT','TEXTAREA'],GAME:['CANVAS'],MULTIMEDIA:['AUDIO','IMG','VIDEO'],REFERENCE:['A','IFRAME','EMBED','OBJECT'],TEXT:['ABBR','ADDRESS','B','BDI','BDO','BLOCKQUOTE','CAPTION','CITE','CODE','DD','DEL','DIV','DFN','DIALOG','DT','EM','FIGCAPTION','H1','H2','H3','H4','H5','H6','I','INS','LABEL','LEGEND','LI','MARK','P','PRE','Q','S','SAMP','SMALL','SPAN','STRONG','SUB','SUMMARY','SUP','TIME','TH','TD','U','VAR'],init(){this.selector=this.REFERENCE.join(',')+','+this.TEXT.join(',')+','+this.MULTIMEDIA.join(','),this.containers=this.CONTENT.join(','),this.filter=':not(:has('+this.containers+'))'}},events:{documentClicked(){wi.current.active&&wi.box.remove()},elementCreated(a){if(wi.current.active){const b=$(a.target),c=wi.elements;if(!b.hasClass(wi.css.CONTENT_BOX_CLASS)){let d=b.find(c.selector).filter(c.filter).filter(':not(.'+wi.css.ELEMENT+')');!b.hasClass(wi.css.ELEMENT)&&b.is(c.selector)&&0==b.find(c.containers).length&&(d=d.add(b)),wi.current.addElements(d)}}},elementClick(a){wi.current.active&&(a.preventDefault(),a.stopPropagation(),wi.box.remove(),wi.box.add($(a.target)))},keyPress(a){console.log(a.keyCode),wi.current.active&&27==a.keyCode&&chrome.extension.sendRequest({action:'toggleIcon'})},windowResizeOrScroll(){wi.current.active&&0<wi.current.contentBox.length&&0<wi.current.element.length&&wi.box.setStyles(wi.current.contentBox,wi.current.element)}},box:{add(a){const b=$('<div class="'+wi.css.CONTENT_BOX_CLASS+'"></div>'),c=$('<div class="'+wi.css.DATA_BOX_CLASS+'"></div>'),d=$('<div class="'+wi.css.FILLER_BOX_CLASS+'"></div>'),e=$('<div class="'+wi.css.CLOSE_BUTTON_CLASS+'">X</div>'),f=this.getMetadata(a);let g='<form>';for(let h=0;h<f.length;h++){const j=f[h];j.value&&(g+=`<div class="${wi.css.DATA_FIELD}">
							<label for="${j.id}">${j.label}:</label>`+(-1==j.id.indexOf('src')?`<span>${j.value}</span>`:`<a href="${j.value}" target="_blank">${j.value}</a>`)+(-1==j.id.indexOf('color')?'':`<select class="${wi.css.COLOR_SELECT_CLASS}">
									<option value="hex">HEX</option>
									<option value="rgb" selected>RGB</option>
								</select>`)+'</div>')}g+='<form>',b.on('click',h=>{h.stopPropagation()}).on('change','select.'+wi.css.COLOR_SELECT_CLASS,h=>{const j=$(h.currentTarget),k=j.prev(),l=j.val(),m=k.data('rgb')||k.text(),n=k.data('hex')||wi.utils.colors.rgb2hex(m);k.data({rgb:m,hex:n});'rgb'===l?k.text(m):'hex'===l?k.text(n):void 0}),e.on('click',wi.events.documentClicked),c.append(g),b.append(e),b.append(c),b.append(d),$('body').append(b),this.setStyles(b,a),wi.current.contentBox=b,wi.current.element=a},getMetadata(a){const b=[],c=[],d=[],e=a[0].tagName,f=a.text(),g=wi.utils.parseColor(a.css('color')),h=wi.utils.parseColor(a.css('background-color')),j=wi.utils.parseBackgroundImage(a.css('background-image')),k=wi.utils.parseSourceURL(a.attr('href')),l=wi.utils.parseSourceURL(a.attr('src')||a.children('source').attr('src'));return f&&'string'==typeof f&&b.push({id:'font',label:chrome.i18n.getMessage('fieldFontLabel'),value:a.css('font-family')},{id:'fsize',label:chrome.i18n.getMessage('fieldFSizeLabel'),value:a.css('font-size')},{id:'text-color',label:chrome.i18n.getMessage('fieldTextColorLabel'),value:g},{id:'background-color',label:chrome.i18n.getMessage('fieldBackgroundColorLabel'),value:h}),wi.elements.REFERENCE.includes(e)&&c.push({id:'src',label:chrome.i18n.getMessage('fieldSourceLabel'),value:k||l},{id:'lang',label:chrome.i18n.getMessage('fieldLangLabel'),value:a.attr('hreflang')}),(wi.elements.MULTIMEDIA.includes(e)||j)&&d.push({id:'width',label:chrome.i18n.getMessage('fieldWidthLabel'),value:a.width()+'px'},{id:'height',label:chrome.i18n.getMessage('fieldHeightLabel'),value:a.height()+'px'},{id:'src',label:chrome.i18n.getMessage('fieldSourceLabel'),value:l},{id:'desc',label:chrome.i18n.getMessage('fieldDescLabel'),value:a.attr('alt')},{id:'image-src',label:chrome.i18n.getMessage('fieldBackgroundImageLabel'),value:j}),[...b,...c,...d]},setStyles(a,b){const c=a.children('.'+wi.css.DATA_BOX_CLASS),d=a.children('.'+wi.css.FILLER_BOX_CLASS),e=a.children('.'+wi.css.CLOSE_BUTTON_CLASS),f=$(document).outerHeight(),g=$(window).outerWidth(),h=$(window).outerHeight(),j=b.outerWidth(),k=b.outerHeight();let l=parseInt(a.css('min-width'),10);l=j>l?j:l;const m=parseInt(a.css('border-width'),10);a.css('width',l);const n=k+a.height(),o=b.offset(),p={top:o.top-m,left:o.left-m,right:o.left+l+m,bottom:o.top+n+m},q={},r={},s={};p.right>g?(q.left='initial',q.right=g-(o.left+j+m),s.left=0,s.right='initial',e.addClass('top left')):(q.left=p.left,q.right='initial',s.left='initial',s.right=0,e.addClass('top right')),p.bottom>f?(q.top='initial',q.bottom=h-(o.top+k+m),r.paddingTop=0,r.paddingBottom=m/2,r.marginTop=0,r.marginBottom=k,s.top='initial',s.bottom=0):(q.top=p.top,q.bottom='initial',r.paddingTop=m/2,r.paddingBottom=0,r.marginTop=k,r.marginBottom=0,s.top=0,s.bottom='initial'),l>j?(s.width=l-j,s.height=k,s.display='block'):s.display='none',d.css(s),c.css(r),a.css(q)},remove(){wi.current.contentBox.remove(),wi.current.element=$()}},utils:{colors:{rgbRegex:/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/,hexDigits:['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'],isRgb(){return 4===rgb.match(this.rgbRegex).length},rgb2hex(a){return a=a.match(this.rgbRegex),'#'+this.hex(a[1])+this.hex(a[2])+this.hex(a[3])},hex(a){return isNaN(a)?'00':this.hexDigits[(a-a%16)/16]+this.hexDigits[a%16]}},parseColor(a){return'transparent'==a?'':a},parseBackgroundImage(a){return'url'==a.substr(0,3)?this.parseSourceURL(a.replace('url(','').replace(')','')):''},parseSourceURL(a){return a&&-1==a.indexOf('://')&&(a=window.location.protocol+'//'+window.location.host+(window.location.port?':'+window.location.port:'')+('/'==a.charAt(0)?'':'/')+a),a}}};wi.elements.init();